!function(t,e){function o(e,o){var a=this;a.o=t.extend({},n,o),a.e=t(e),a.init()}var a="collapser",n={target:"next",mode:"words",speed:"slow",truncate:10,ellipsis:"...",effect:"fade",controlBtn:"",showText:"Show more",hideText:"Hide text",showClass:"show-class",hideClass:"hide-class",atStart:"hide",lockHide:!1,dynamic:!1,changeText:!1,beforeShow:null,afterShow:null,beforeHide:null,afterHide:null};o.prototype={init:function(){var o=this;o.mode=o.o.mode,o.remaining={},o.ctrlHtml=' <a href="#" data-ctrl class="'+(t.isFunction(o.o.controlBtn)?"":o.o.controlBtn)+'"></a>',t(o.e).each(function(){t(this).data("oCnt",o.e.html());var e=t.isFunction(o.o.atStart)?o.o.atStart.call(o.e):o.o.atStart;e="undefined"!=typeof o.e.attr("data-start")?o.e.attr("data-start"):e,"hide"==e?o.hide(o.e,0):o.show(o.e,0)});var a;t(e).on("resize",function(){o.o.dynamic&&"lines"==o.mode&&(clearTimeout(a),a=setTimeout(function(){o.reInit(o.e)},100))})},show:function(e,o){var a=this,n=t(e);"undefined"==typeof o&&(o=a.o.speed);var i=function(){t.isFunction(a.o.afterShow)&&a.o.afterShow.call(a.e,a)};switch(t.isFunction(a.o.beforeShow)&&a.o.beforeShow.call(a.e,a),a.mode){case"chars":case"words":var l=n.height();n.html(n.data("tHTML"));var s=n.height();n.height(l),n.animate({height:s},o,function(){n.height("auto"),i()}).removeClass(a.o.hideClass).addClass(a.o.showClass),n.data("tHTML",n.html());break;case"lines":0==n.children("div").length&&n.wrapInner("<div>");{var c=n.children("div"),r=c.height(),h=c.html(n.data("oCnt")).css("height","").height();c.css("height",r)}c.animate({height:h},o,function(){c.height("auto"),i()}),n.removeClass(a.o.hideClass).addClass(a.o.showClass);break;case"block":a.blockMode(n,"show",o,i)}return a.status=1,1==a.o.lockHide?(n.find("[data-ctrl]").remove(),""):void("block"==a.mode?n.off("click.coll").on("click.coll",function(t){t.preventDefault(),a.hide(n)}):(0!=n.find("[data-ctrl]").length||t.isFunction(a.o.controlBtn)||n.append(a.ctrlHtml),a.ctrlBtn=t.isFunction(a.o.controlBtn)?a.o.controlBtn.call(a.e):t(n.find("[data-ctrl]")),a.ctrlBtn.off("click.coll").on("click.coll",function(t){t.preventDefault(),a.hide(n)}).html(a.o.hideText)))},hide:function(e,o){var a=this,n=t(e);"undefined"==typeof o&&(o=a.o.speed);var i=function(){t.isFunction(a.o.afterHide)&&a.o.afterHide.call(a.e,a)};switch(t.isFunction(a.o.beforeHide)&&a.o.beforeHide.call(a.e,a),n.find("[data-ctrl]").remove(),a.mode){case"chars":var l=t.trim(n.text());a.remaining.chars=l.length-a.o.truncate,l.length>a.o.truncate&&(n.data("tHTML",n.html()),l=a.pad(l.slice(0,a.o.truncate),l.slice(a.o.truncate,l.length)),n.html(l).removeClass(a.o.showClass).addClass(a.o.hideClass),i());break;case"words":var l=t.trim(n.text()),s=l.split(" ");a.remaining.words=s.length-a.o.truncate,s.length>a.o.truncate&&(n.data("tHTML",n.html()),l=a.pad(s.slice(0,a.o.truncate).join(" "),s.slice(a.o.truncate,s.length).join(" ")),n.html(l).removeClass(a.o.showClass).addClass(a.o.hideClass),i());break;case"lines":0==n.children("div").length&&n.wrapInner("<div>");var c=n.children("div").css("height","");c.html(c.text());var r=c.height();"undefined"==typeof n.data("lHeight")?(temp=c.clone(),lHeight=temp.text("a").insertAfter(c).height(),n.data("lHeight",lHeight),c.next().remove()):lHeight=n.data("lHeight"),lines=r/lHeight,a.remaining.lines=lines-a.o.truncate,a.remaining.lines>0&&(c.css("overflow","hidden"),c.animate({height:lHeight*a.o.truncate},o).data("tHeight",r),n.removeClass(a.o.showClass).addClass(a.o.hideClass),0!=n.find("[data-ctrl]").length||t.isFunction(a.o.controlBtn)||n.append(a.ctrlHtml),i());break;case"block":a.blockMode(n,"hide",o,i)}if(a.status=0,"block"==a.mode)n.unbind("click.coll").bind("click.coll",function(t){t.preventDefault(),a.show(n)});else{a.ctrlBtn=t.isFunction(a.o.controlBtn)?a.o.controlBtn.call(a.e):t(n.find("[data-ctrl]")),a.ctrlBtn.off("click.coll").on("click.coll",function(t){t.preventDefault(),a.show(n)}).html(a.o.showText);var h=a.o.showText,d={chars:["character","characters"],words:["word","words"],lines:["lines","lines"]},f=a.remaining[a.mode]+(1==a.remaining[a.mode]?" "+d[a.mode][0]:" "+d[a.mode][1]);h=h.replace("%s",f),a.ctrlBtn.html(h)}},pad:function(e,o){var a=this;return"<p>"+e+'<span class="coll-ellipsis">'+a.o.ellipsis+"</span>"+(t.isFunction(a.o.ctrlBtn)?"":a.ctrlHtml)+'</p><span class="coll-hidden" style="display:none">'+o+"</span>"},blockMode:function(e,o,a,n){var i=this,l=["fadeOut","slideUp","fadeIn","slideDown"],s="fade"==i.o.effect?0:1,c="hide"==o?l[s]:l[s+2];t.isFunction(i.o.target)?i.o.target.call(i.e)[c](a,n):t.fn[i.o.target]&&t(e)[i.o.target]()[c](a,n),"show"==o?(e.removeClass(i.o.showClass).addClass(i.o.hideClass),i.o.changeText&&e.text(i.o.hideText)):(e.removeClass(i.o.hideClass).addClass(i.o.showClass),i.o.changeText&&e.text(i.o.showText))},reInit:function(t){var e=this;t.find("[data-ctrl]").remove(),t.html(e.e.data("oCnt")),0==e.status?e.hide(t,0):e.show(t,0)}},t.fn[a]=function(e){return this.each(function(){t.data(this,a)||t.data(this,a,new o(this,e))})}}(jQuery,window,document);